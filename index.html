<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DepthForge</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

[data-theme="light"] {
  --bg: #f5f5f0;
  --surface: #ffffff;
  --border: #e5e3dc;
  --border2: #d0cdc5;
  --text: #1a1916;
  --muted: #888480;
  --muted2: #b0ada5;
  --accent: #c96c3a;
  --accent-light: #fdf0e8;
  --danger: #dc4a3d;
  --success: #3d8c5f;
  --shadow: 0 1px 3px rgba(0,0,0,0.07);
  --shadow-md: 0 4px 14px rgba(0,0,0,0.09);
}
[data-theme="dark"] {
  --bg: #0f0f14;
  --surface: #17171f;
  --border: #26263a;
  --border2: #32324a;
  --text: #ededf5;
  --muted: #7878a0;
  --muted2: #50506a;
  --accent: #e07840;
  --accent-light: rgba(224,120,64,0.13);
  --danger: #e05050;
  --success: #4aad72;
  --shadow: 0 1px 3px rgba(0,0,0,0.35);
  --shadow-md: 0 4px 14px rgba(0,0,0,0.45);
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  font-size: 14px;
  line-height: 1.5;
  transition: background 0.2s, color 0.2s;
}

/* ‚îÄ‚îÄ TOPNAV ‚îÄ‚îÄ */
.topnav {
  height: 52px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 20px;
  gap: 6px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow);
}
.nav-logo {
  display: flex; align-items: center; gap: 8px; margin-right: 12px;
}
.nav-logo-icon {
  width: 26px; height: 26px; border-radius: 6px;
  background: var(--text); color: var(--bg);
  display: flex; align-items: center; justify-content: center;
  font-size: 13px; flex-shrink: 0;
}
.nav-logo-text {
  font-family: 'Instrument Serif', serif;
  font-size: 16px; color: var(--text);
}
.nav-tab {
  display: flex; align-items: center; gap: 5px;
  padding: 6px 11px; border-radius: 7px;
  cursor: pointer; color: var(--muted);
  font-size: 13px; font-weight: 500;
  border: none; background: none;
  transition: all 0.15s;
}
.nav-tab:hover { background: var(--bg); color: var(--text); }
.nav-tab.active { background: var(--bg); color: var(--text); }
.nav-tab.hidden { display: none; }
.nav-badge {
  background: var(--accent-light); color: var(--accent);
  font-size: 10px; font-weight: 700;
  padding: 1px 6px; border-radius: 8px;
}
.nav-right { margin-left: auto; display: flex; align-items: center; gap: 10px; }
.theme-toggle {
  cursor: pointer; display: flex; align-items: center; gap: 5px;
}
.toggle-track {
  width: 36px; height: 20px; border-radius: 20px;
  background: #ccc; position: relative;
  transition: background 0.3s; flex-shrink: 0;
}
.toggle-knob {
  width: 14px; height: 14px; border-radius: 50%;
  background: #fff; position: absolute;
  top: 3px; left: 3px;
  transition: transform 0.3s;
  box-shadow: 0 1px 3px rgba(0,0,0,0.25);
}
.nav-user {
  display: flex; align-items: center; gap: 7px;
  padding: 4px 10px; border-radius: 7px;
  border: 1px solid var(--border); background: var(--bg);
  font-size: 13px;
}
.nav-avatar {
  width: 22px; height: 22px; border-radius: 50%;
  background: var(--text); color: var(--surface);
  display: flex; align-items: center; justify-content: center;
  font-size: 10px; font-weight: 700; flex-shrink: 0;
}
.nav-signout {
  background: none; border: none; cursor: pointer;
  color: var(--muted); font-size: 11px; padding: 0 2px;
}
.nav-signout:hover { color: var(--danger); }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { flex: 1; display: flex; flex-direction: column; }
.page { padding: 28px 20px; max-width: 640px; width: 100%; margin: 0 auto; flex: 1; }

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel { display: none; }
.panel.active { display: block; animation: fadeIn 0.18s ease; }
@keyframes fadeIn { from { opacity:0; transform:translateY(4px); } to { opacity:1; transform:translateY(0); } }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 11px; padding: 20px; margin-bottom: 14px;
  box-shadow: var(--shadow);
}

/* ‚îÄ‚îÄ FIELDS ‚îÄ‚îÄ */
.field { margin-bottom: 12px; }
.field-label { display: block; font-size: 11px; font-weight: 600; color: var(--muted); margin-bottom: 4px; letter-spacing: 0.04em; text-transform: uppercase; }
input[type=text], input[type=email], input[type=tel], input[type=password] {
  width: 100%; padding: 9px 11px;
  background: var(--bg); border: 1px solid var(--border2);
  border-radius: 8px; font-family: 'Inter', sans-serif;
  font-size: 14px; color: var(--text); outline: none;
  transition: border-color 0.15s, box-shadow 0.15s;
}
input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(201,108,58,0.1); }
input::placeholder { color: var(--muted2); }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 9px 15px; border-radius: 8px;
  font-family: 'Inter', sans-serif; font-size: 13px; font-weight: 500;
  cursor: pointer; border: none; transition: all 0.15s; width: 100%;
}
.btn-primary { background: var(--text); color: var(--bg); }
.btn-primary:hover { opacity: 0.88; }
.btn-outline { background: transparent; color: var(--text); border: 1px solid var(--border2); }
.btn-outline:hover { background: var(--bg); }
.btn-google {
  background: var(--surface); color: var(--text);
  border: 1px solid var(--border2);
}
.btn-google:hover { background: var(--bg); }
.btn-sm { padding: 7px 11px; font-size: 12px; width: auto; }
.btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(220,74,61,0.3); }
.btn-danger:hover { background: rgba(220,74,61,0.07); }

/* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
.steps { display: flex; align-items: center; margin-bottom: 18px; }
.step-num {
  width: 24px; height: 24px; border-radius: 50%;
  border: 1.5px solid var(--border2);
  display: flex; align-items: center; justify-content: center;
  font-size: 11px; font-weight: 600; color: var(--muted2); flex-shrink: 0;
  transition: all 0.2s;
}
.step-num.active { border-color: var(--accent); color: var(--accent); background: var(--accent-light); }
.step-num.done { border-color: var(--text); background: var(--text); color: var(--surface); }
.step-lbl { font-size: 11px; color: var(--muted); margin-left: 5px; }
.step-lbl.active { color: var(--text); font-weight: 500; }
.step-line { flex: 1; height: 1px; background: var(--border2); margin: 0 8px; transition: background 0.2s; }
.step-line.done { background: var(--text); }

/* ‚îÄ‚îÄ OTP ROW ‚îÄ‚îÄ */
.otp-row { display: flex; gap: 8px; }
.otp-row input { flex: 1; letter-spacing: 0.18em; font-size: 17px; font-weight: 600; text-align: center; }

/* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
.divider { display: flex; align-items: center; gap: 10px; margin: 12px 0; }
.divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
.divider span { font-size: 11px; color: var(--muted2); }

/* ‚îÄ‚îÄ ALERTS ‚îÄ‚îÄ */
.alert { padding: 9px 12px; border-radius: 7px; font-size: 13px; margin-bottom: 14px; }
.alert-info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
.alert-success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; }

/* ‚îÄ‚îÄ THEME ROW ‚îÄ‚îÄ */
.theme-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 8px 11px; border: 1px solid var(--border);
  border-radius: 8px; background: var(--bg); margin-bottom: 10px;
}

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-avatar-lg {
  width: 44px; height: 44px; border-radius: 50%;
  background: var(--text); color: var(--surface);
  display: flex; align-items: center; justify-content: center;
  font-size: 17px; font-weight: 600; flex-shrink: 0;
}
.usage-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; }
.usage-track { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.usage-fill { height: 100%; background: var(--accent); border-radius: 3px; transition: width 0.4s; }

/* ‚îÄ‚îÄ UPLOAD ‚îÄ‚îÄ */
.upload-zone {
  border: 1.5px dashed var(--border2); border-radius: 9px;
  padding: 28px 16px; text-align: center; cursor: pointer;
  transition: all 0.2s; position: relative; background: var(--bg);
}
.upload-zone:hover, .upload-zone.dragging { border-color: var(--accent); background: var(--accent-light); }
.upload-zone input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
.upload-text { font-size: 13px; color: var(--muted); margin-top: 6px; }
.upload-text strong { color: var(--accent); }
.upload-text small { display: block; margin-top: 3px; font-size: 11px; color: var(--muted2); }
#imgPreview { width: 100%; border-radius: 7px; margin-top: 12px; display: none; max-height: 180px; object-fit: cover; border: 1px solid var(--border); }

/* ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ */
.progress-wrap { margin: 12px 0; display: none; }
.progress-track { height: 3px; background: var(--border); border-radius: 3px; overflow: hidden; }
.progress-bar { height: 100%; width: 0; background: var(--accent); border-radius: 3px; transition: width 0.4s ease; }
.progress-lbl { font-size: 11px; color: var(--muted); margin-top: 5px; }

/* ‚îÄ‚îÄ DEPTH RESULT ‚îÄ‚îÄ */
.depth-result { display: none; }
.depth-wrap { border-radius: 9px; overflow: hidden; background: #0a0a0a; border: 1px solid var(--border); margin-bottom: 10px; }
#depthCanvas { width: 100%; display: block; height: 240px; }

/* ‚îÄ‚îÄ PLANS ‚îÄ‚îÄ */
.plan-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
.plan-card { border: 1.5px solid var(--border2); border-radius: 9px; padding: 15px; cursor: pointer; transition: all 0.2s; position: relative; }
.plan-card:hover { border-color: var(--accent); background: var(--accent-light); }
.plan-badge { position: absolute; top: -1px; right: 10px; background: var(--text); color: var(--surface); font-size: 9px; font-weight: 700; padding: 2px 7px; border-radius: 0 0 5px 5px; }
.plan-name { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
.plan-price { font-size: 20px; font-weight: 700; color: var(--accent); }
.plan-price span { font-size: 12px; font-weight: 400; color: var(--muted); }
.plan-feat { font-size: 11px; color: var(--muted); padding: 2px 0; display: flex; align-items: center; gap: 5px; }
.plan-feat::before { content: '‚úì'; color: var(--success); font-weight: 700; }
.upi-block { border: 1px solid var(--border); border-radius: 9px; padding: 16px; text-align: center; background: var(--bg); }
.upi-id { font-size: 13px; font-weight: 600; color: var(--accent); margin: 8px 0; font-family: monospace; }
.qr-img { width: 120px; height: 120px; border-radius: 7px; border: 1px solid var(--border); }

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
.stat-card { border: 1px solid var(--border); border-radius: 9px; padding: 14px; background: var(--bg); }
.stat-val { font-size: 24px; font-weight: 700; font-family: 'Instrument Serif', serif; }
.stat-lbl { font-size: 10px; color: var(--muted); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.07em; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 18px; left: 50%;
  transform: translateX(-50%) translateY(70px);
  background: var(--text); color: var(--surface);
  border-radius: 8px; padding: 9px 16px;
  font-size: 13px; font-weight: 500; z-index: 9999;
  transition: transform 0.25s ease;
  display: flex; align-items: center; gap: 7px;
  box-shadow: var(--shadow-md); white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }
.toast.error { background: var(--danger); color: #fff; }
.toast.success { background: #166534; color: #fff; }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
.footer { padding: 14px 20px; border-top: 1px solid var(--border); text-align: center; }
.footer a { font-size: 11px; color: var(--muted2); text-decoration: none; transition: color 0.15s; }
.footer a:hover { color: var(--accent); }

/* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
@media(max-width: 600px) {
  .topnav { padding: 0 12px; }
  .page { padding: 18px 14px; }
  .plan-grid { grid-template-columns: 1fr; }
  .nav-logo-text { display: none; }
}
</style>
</head>
<body>

<!-- TOP NAV -->
<nav class="topnav">
  <div class="nav-logo">
    <div class="nav-logo-icon">‚¨°</div>
    <span class="nav-logo-text">DepthForge</span>
  </div>

  <button class="nav-tab active" onclick="switchTab('home')" id="nav-home">üîê Login</button>
  <button class="nav-tab hidden" onclick="switchTab('generate')" id="nav-generate">‚ú® Generate <span class="nav-badge" id="remainingBadge">10</span></button>
  <button class="nav-tab hidden" onclick="switchTab('premium')" id="nav-premium">üëë Premium</button>
  <button class="nav-tab" onclick="switchTab('owner')" id="nav-owner">üõ†Ô∏è Owner</button>

  <div class="nav-right">
    <!-- Theme toggle -->
    <div class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
      <span id="themeIcon" style="font-size:12px;">‚òÄÔ∏è</span>
      <div class="toggle-track" id="themeTrack">
        <div class="toggle-knob" id="themeKnob"></div>
      </div>
    </div>

    <!-- User chip -->
    <div class="nav-user" id="navUser" style="display:none">
      <div class="nav-avatar" id="navAvatar">U</div>
      <span id="navName" style="font-size:13px;font-weight:500;">‚Äî</span>
      <button class="nav-signout" onclick="logout()">Sign out</button>
    </div>
  </div>
</nav>

<div class="main">
<div class="page">

  <!-- ‚ïê‚ïê HOME / LOGIN ‚ïê‚ïê -->
  <div class="panel active" id="panel-home">

    <!-- NOT LOGGED IN -->
    <div id="loginSection" style="max-width:340px;margin:32px auto 0;">
      <h1 style="font-family:'Instrument Serif',serif;font-size:24px;font-weight:400;text-align:center;margin-bottom:20px;">Welcome to DepthForge</h1>

      <div class="card" style="padding:18px;">
        <!-- STEPS -->
        <div class="steps">
          <div class="step-num active" id="s1">1</div>
          <span class="step-lbl active" id="sl1t">Phone</span>
          <div class="step-line" id="sl1"></div>
          <div class="step-num" id="s2">2</div>
          <span class="step-lbl" id="sl2t">OTP</span>
          <div class="step-line" id="sl2"></div>
          <div class="step-num" id="s3">3</div>
          <span class="step-lbl" id="sl3t">Profile</span>
        </div>

        <!-- STEP 1 -->
        <div id="step1">
          <div class="field">
            <label class="field-label">Phone Number</label>
            <input type="tel" id="phone" placeholder="98765 43210" autofocus>
          </div>
          <button class="btn btn-primary" onclick="sendOTP()">Continue ‚Üí</button>

          <div class="divider"><span>or</span></div>

          <!-- GOOGLE LOGIN -->
          <button class="btn btn-google" onclick="googleLogin()">
            <svg width="15" height="15" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Continue with Google
          </button>

          <div class="divider"><span>New user?</span></div>

          
          <button class="btn btn-outline" onclick="sendOTP()">‚ú® Create Account</button>
        </div> 

        <!-- STEP 2 -->
        <div id="step2" style="display:none">
          <div class="alert alert-info">OTP has been sent to your phone.</div>
          <div class="field">
            <label class="field-label">Enter OTP</label>
            <div class="otp-row">
              <input type="text" id="otp" placeholder="¬∑ ¬∑ ¬∑ ¬∑" maxlength="4" inputmode="numeric">
              <button class="btn btn-outline btn-sm" onclick="resendOTP()">Resend</button>
            </div>
          </div>
          <button class="btn btn-primary" onclick="verifyOTP()">Verify OTP ‚Üí</button>
        </div>

        <!-- STEP 3 -->
        <div id="step3" style="display:none">
          <div class="alert alert-success">‚úì OTP verified! Complete your profile.</div>
          <div class="field">
            <label class="field-label">Full Name</label>
            <input type="text" id="pname" placeholder="Your name">
          </div>
          <div class="field">
            <label class="field-label">Email (optional)</label>
            <input type="email" id="pemail" placeholder="you@example.com">
          </div>
          <button class="btn btn-primary" onclick="saveProfile()">Save & Continue ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- LOGGED IN -->
    <div id="profileSection" style="display:none;max-width:400px;margin:0 auto;">
      <div class="card">
        <div style="display:flex;align-items:center;gap:12px;padding-bottom:16px;border-bottom:1px solid var(--border);margin-bottom:16px;">
          <div class="profile-avatar-lg" id="profileAvatar">U</div>
          <div>
            <div style="font-size:15px;font-weight:600;" id="profileName">‚Äî</div>
            <div style="font-size:12px;color:var(--muted);" id="profilePhone">‚Äî</div>
          </div>
        </div>
        <div style="margin-bottom:14px;">
          <div class="usage-row"><span style="color:var(--muted);">Daily Usage</span><span id="usageLabel" style="font-weight:600;">0 / 10</span></div>
          <div class="usage-track"><div class="usage-fill" id="usageFill" style="width:0%"></div></div>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-primary" style="flex:1;" onclick="switchTab('generate')">‚ú® Generate 3D</button>
          <button class="btn btn-outline" style="width:auto;padding:9px 14px;" onclick="logout()">Sign Out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê GENERATE ‚ïê‚ïê -->
  <div class="panel" id="panel-generate">
    <h2 style="font-family:'Instrument Serif',serif;font-size:20px;font-weight:400;margin-bottom:4px;">Generate 3D Depth</h2>
    <p style="color:var(--muted);font-size:13px;margin-bottom:16px;">Upload an image and generate a 3D depth map using AI.</p>
    <div class="card">
      <div style="margin-bottom:14px;">
        <div class="usage-row"><span style="color:var(--muted);">Remaining today</span><span id="genUsageLabel" style="font-weight:600;color:var(--accent);">10 left</span></div>
        <div class="usage-track"><div class="usage-fill" id="genUsageFill" style="width:0%"></div></div>
      </div>
      <div class="upload-zone" id="uploadZone">
        <input type="file" id="imgFile" accept="image/*" onchange="previewImage(this)">
        <div style="font-size:28px;">üåÑ</div>
        <div class="upload-text"><strong>Click to upload</strong> or drag & drop<small>PNG, JPG, WEBP ‚Äî max 10MB</small></div>
        <img id="imgPreview" alt="preview">
      </div>
      <div class="progress-wrap" id="progressWrap">
        <div class="progress-track"><div class="progress-bar" id="progressFill"></div></div>
        <div class="progress-lbl" id="progressLabel">Processing‚Ä¶</div>
      </div>
      <button class="btn btn-primary" style="margin-top:12px;" onclick="generate3D()">‚ö° Generate Depth Map</button>
    </div>
    <div class="card depth-result" id="depthResult">
      <div style="font-size:14px;font-weight:600;margin-bottom:10px;">‚úì Depth Map Ready</div>
      <div class="depth-wrap"><canvas id="depthCanvas"></canvas></div>
      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="btn btn-outline" style="flex:1;" onclick="downloadDepth()">‚¨á Download</button>
        <button class="btn btn-primary" style="flex:1;" onclick="toggle3D()">üîÑ 3D View</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê PREMIUM ‚ïê‚ïê -->
  <div class="panel" id="panel-premium">
    <h2 style="font-family:'Instrument Serif',serif;font-size:20px;font-weight:400;margin-bottom:4px;">Premium Plans</h2>
    <p style="color:var(--muted);font-size:13px;margin-bottom:16px;">Upgrade for unlimited generations and priority processing.</p>
    <div class="card">
      <div class="plan-grid">
        <div class="plan-card" onclick="selectPlan('monthly')">
          <div class="plan-name">Monthly</div>
          <div class="plan-price">‚Çπ100 <span>/ month</span></div>
          <div style="margin-top:8px;">
            <div class="plan-feat">Unlimited generations</div>
            <div class="plan-feat">Priority processing</div>
            <div class="plan-feat">HD depth maps</div>
          </div>
        </div>
        <div class="plan-card" onclick="selectPlan('yearly')">
          <div class="plan-badge">BEST VALUE</div>
          <div class="plan-name">Annual</div>
          <div class="plan-price">‚Çπ1,000 <span>/ year</span></div>
          <div style="margin-top:8px;">
            <div class="plan-feat">All Monthly features</div>
            <div class="plan-feat">Save ‚Çπ200</div>
            <div class="plan-feat">Early access</div>
            <div class="plan-feat">Priority support</div>
          </div>
        </div>
      </div>
      <div class="upi-block">
        <p style="font-size:12px;color:var(--muted);">Pay via UPI</p>
        <div class="upi-id">ujavalsingh9942-1@okhdfcbank</div>
        <img class="qr-img" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=ujavalsingh9942-1@okhdfcbank&cu=INR" alt="UPI QR">
        <p style="font-size:11px;color:var(--muted);margin-top:8px;">Send payment screenshot on WhatsApp for activation.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê OWNER ‚ïê‚ïê -->
  <div class="panel" id="panel-owner">
    <h2 style="font-family:'Instrument Serif',serif;font-size:20px;font-weight:400;margin-bottom:16px;">Owner Access</h2>
    <div id="ownerLoginForm">
      <div class="card" style="max-width:320px;">
        <div class="field"><label class="field-label">User ID</label><input type="text" id="ownerUid" placeholder="Owner ID"></div>
        <div class="field"><label class="field-label">Password</label><input type="password" id="ownerPwd" placeholder="Password"></div>
        <button class="btn btn-primary" onclick="ownerLogin()">Access Dashboard ‚Üí</button>
      </div>
    </div>
    <div id="ownerDash" style="display:none;">
      <div class="stat-grid">
        <div class="stat-card"><div class="stat-val" id="statUsers">‚Äî</div><div class="stat-lbl">Total Users</div></div>
        <div class="stat-card"><div class="stat-val" id="statPremium">‚Äî</div><div class="stat-lbl">Premium Users</div></div>
        <div class="stat-card"><div class="stat-val">‚Çπ100</div><div class="stat-lbl">Monthly Plan</div></div>
        <div class="stat-card"><div class="stat-val">‚Çπ1k</div><div class="stat-lbl">Annual Plan</div></div>
      </div>
      <button class="btn btn-danger" style="width:auto;padding:8px 14px;" onclick="ownerLogout()">Sign Out</button>
    </div>
  </div>

</div><!-- /page -->

<div class="footer">
  <a href="https://ujavalproduction.com" target="_blank">‚ö° Made by UjavalProduction</a>
</div>
</div><!-- /main -->

<div class="toast" id="toast"><span id="toastIcon">‚úì</span><span id="toastMsg">Done!</span></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>
<script>
/* ‚îÄ‚îÄ THEME ‚îÄ‚îÄ */
function setTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  localStorage.setItem('df_theme', t);
  const dark = t === 'dark';
  const icon = dark ? 'üåô' : '‚òÄÔ∏è';
  const trackBg = dark ? '#1db954' : '#ccc';
  const knobX = dark ? 'translateX(16px)' : 'translateX(0)';
  ['themeIcon','themeIcon2'].forEach(id => { const el=document.getElementById(id); if(el) el.textContent=icon; });
  ['themeTrack','themeTrack2'].forEach(id => { const el=document.getElementById(id); if(el) el.style.background=trackBg; });
  ['themeKnob','themeKnob2'].forEach(id => { const el=document.getElementById(id); if(el) el.style.transform=knobX; });
}
function toggleTheme() {
  setTheme(localStorage.getItem('df_theme')==='dark' ? 'light' : 'dark');
}
setTheme(localStorage.getItem('df_theme') || 'light');

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let state = { phone:null, name:null, remaining:10, is_premium:false };
let currentDepthUrl = null;

window.addEventListener('DOMContentLoaded', async () => {
  await loadUser();
  setupDragDrop();
});

async function loadUser() {
  try {
    const res = await fetch('/me');
    if (res.ok) { const d = await res.json(); if (d.name) { state = {phone:d.phone,name:d.name,remaining:d.remaining,is_premium:d.is_premium}; renderIn(); } }
  } catch(e) {}
}

function renderIn() {
  const init = (state.name||'U')[0].toUpperCase();
  document.getElementById('navUser').style.display = 'flex';
  document.getElementById('navAvatar').textContent = init;
  document.getElementById('navName').textContent = state.name;
  document.getElementById('nav-generate').classList.remove('hidden');
  document.getElementById('nav-premium').classList.remove('hidden');
  document.getElementById('loginSection').style.display = 'none';
  document.getElementById('profileSection').style.display = 'block';
  document.getElementById('profileAvatar').textContent = init;
  document.getElementById('profileName').textContent = state.name;
  document.getElementById('profilePhone').textContent = state.phone;
  updateUsage();
}

function renderOut() {
  document.getElementById('navUser').style.display = 'none';
  document.getElementById('nav-generate').classList.add('hidden');
  document.getElementById('nav-premium').classList.add('hidden');
  document.getElementById('loginSection').style.display = 'block';
  document.getElementById('profileSection').style.display = 'none';
}

function updateUsage() {
  const used = state.is_premium ? 0 : (10 - state.remaining);
  const pct = state.is_premium ? 0 : Math.min((used/10)*100, 100);
  document.getElementById('usageLabel').textContent = state.is_premium ? 'Unlimited' : `${used} / 10`;
  document.getElementById('usageFill').style.width = pct + '%';
  document.getElementById('genUsageLabel').textContent = state.is_premium ? 'Unlimited' : `${state.remaining} left`;
  document.getElementById('genUsageFill').style.width = pct + '%';
  document.getElementById('remainingBadge').textContent = state.is_premium ? '‚àû' : state.remaining;
}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
function switchTab(t) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-'+t).classList.add('active');
  document.getElementById('nav-'+t).classList.add('active');
}

/* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
function goStep(n) {
  [1,2,3].forEach(i => {
    document.getElementById('step'+i).style.display = i===n ? 'block' : 'none';
    const el = document.getElementById('s'+i);
    el.className = 'step-num' + (i<n?' done':i===n?' active':'');
    el.textContent = i<n ? '‚úì' : i;
    const lbl = document.getElementById('sl'+i+'t');
    if(lbl) lbl.className = 'step-lbl' + (i===n?' active':'');
  });
  if(n>1) document.getElementById('sl1').classList.add('done');
  if(n>2) document.getElementById('sl2').classList.add('done');
}

/* ‚îÄ‚îÄ OTP ‚îÄ‚îÄ */
async function sendOTP() {
  const phone = document.getElementById('phone').value.trim();
  if(!phone) return toast('Enter phone number', 'error');
  try {
    const r = await fetch('/send_otp', {method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'phone='+encodeURIComponent(phone)});
    const d = await r.json();
    if(d.status==='sent') { sessionStorage.setItem('otp_phone',phone); goStep(2); toast('OTP sent!','success'); }
    else toast(d.message||'Error','error');
  } catch(e) { toast('Cannot connect to server','error'); }
}

async function resendOTP() {
  const phone = sessionStorage.getItem('otp_phone');
  await fetch('/send_otp',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'phone='+encodeURIComponent(phone)});
  toast('New OTP sent!','success');
}

async function verifyOTP() {
  const phone = sessionStorage.getItem('otp_phone');
  const entered = document.getElementById('otp').value.trim();
  if(!entered) return toast('Enter OTP','error');
  try {
    const r = await fetch('/verify_otp',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:`phone=${encodeURIComponent(phone)}&otp=${encodeURIComponent(entered)}`});
    const d = await r.json();
    if(d.status==='ok') { state.phone=phone; goStep(3); toast('OTP verified!','success'); }
    else toast(d.message||'Wrong OTP','error');
  } catch(e) { toast('Cannot connect to server','error'); }
}

async function saveProfile() {
  const name = document.getElementById('pname').value.trim();
  const email = document.getElementById('pemail').value.trim();
  if(!name) return toast('Enter your name','error');
  try {
    const r = await fetch('/save_profile',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:`name=${encodeURIComponent(name)}&email=${encodeURIComponent(email)}`});
    const d = await r.json();
    if(d.status==='ok') { await loadUser(); toast('Welcome, '+name+'! üéâ','success'); }
  } catch(e) { toast('Cannot connect to server','error'); }
}

async function logout() {
  await fetch('/logout',{method:'POST'});
  state = {phone:null,name:null,remaining:10,is_premium:false};
  renderOut(); goStep(1);
  document.getElementById('phone').value='';
  document.getElementById('otp').value='';
  switchTab('home');
  toast('Signed out','success');
}

function googleLogin() {
  toast('Google login coming soon!','success');
}

/* ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ */
function setupDragDrop() {
  const z = document.getElementById('uploadZone');
  z.addEventListener('dragover',e=>{e.preventDefault();z.classList.add('dragging');});
  z.addEventListener('dragleave',()=>z.classList.remove('dragging'));
  z.addEventListener('drop',e=>{e.preventDefault();z.classList.remove('dragging');const f=e.dataTransfer.files[0];if(f){document.getElementById('imgFile').files=e.dataTransfer.files;previewImage(document.getElementById('imgFile'));}});
}

function previewImage(input) {
  const f = input.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = e => { const p=document.getElementById('imgPreview'); p.src=e.target.result; p.style.display='block'; };
  r.readAsDataURL(f);
}

/* ‚îÄ‚îÄ GENERATE ‚îÄ‚îÄ */
async function generate3D() {
  if(!state.phone||!state.name) return toast('Please sign in first','error');
  if(state.remaining<=0) { switchTab('premium'); return toast('Daily limit reached! Upgrade.','error'); }
  const fi = document.getElementById('imgFile');
  if(!fi.files[0]) return toast('Upload an image first','error');
  const pw=document.getElementById('progressWrap'),pf=document.getElementById('progressFill'),pl=document.getElementById('progressLabel');
  pw.style.display='block'; pf.style.width='8%'; pl.textContent='Uploading‚Ä¶';
  try {
    const fd = new FormData(); fd.append('image',fi.files[0]);
    let prog=8,si=0;
    const steps=['Running MiDaS AI‚Ä¶','Computing depth‚Ä¶','Building 3D map‚Ä¶','Almost done‚Ä¶'];
    const iv = setInterval(()=>{if(prog<88){prog+=4;pf.style.width=prog+'%';pl.textContent=steps[Math.min(si++,3)];}},500);
    const res = await fetch('/generate_3d',{method:'POST',body:fd});
    clearInterval(iv);
    const data = await res.json();
    if(data.status==='ok') {
      pf.style.width='100%'; pl.textContent='Done! ‚úì';
      setTimeout(()=>pw.style.display='none',600);
      state.remaining=data.remaining; updateUsage();
      currentDepthUrl=data.depth;
      document.getElementById('depthResult').style.display='block';
      renderDepthCanvas(data.depth);
      toast('Depth Map ready! üéâ','success');
    } else { pw.style.display='none'; toast(data.message||'Error occurred','error'); }
  } catch(e) { pw.style.display='none'; toast('Cannot connect to server','error'); }
}

function renderDepthCanvas(url) {
  const canvas=document.getElementById('depthCanvas');
  const scene=new THREE.Scene();
  const camera=new THREE.PerspectiveCamera(60,canvas.offsetWidth/240,0.1,100);
  const renderer=new THREE.WebGLRenderer({canvas,alpha:true,antialias:true});
  renderer.setSize(canvas.offsetWidth||400,240); renderer.setPixelRatio(devicePixelRatio);
  new THREE.TextureLoader().load(url,tex=>{
    const mesh=new THREE.Mesh(new THREE.PlaneGeometry(4,3,128,96),new THREE.MeshStandardMaterial({map:tex,displacementMap:tex,displacementScale:0.8,roughness:0.8}));
    scene.add(mesh);
    const l1=new THREE.DirectionalLight(0xffa07a,2); l1.position.set(2,2,2); scene.add(l1);
    const l2=new THREE.DirectionalLight(0x7ab8ff,1); l2.position.set(-2,-1,1); scene.add(l2);
    scene.add(new THREE.AmbientLight(0xffffff,0.5));
    camera.position.set(0,0,4);
    let t=0;
    (function a(){requestAnimationFrame(a);t+=0.01;mesh.rotation.y=Math.sin(t)*0.35;mesh.rotation.x=Math.sin(t*0.6)*0.12;renderer.render(scene,camera);})();
  });
}

function downloadDepth() { if(!currentDepthUrl)return; Object.assign(document.createElement('a'),{href:currentDepthUrl,download:'depthforge_depth.png'}).click(); }
function toggle3D() { toast('3D view active!','success'); }
function selectPlan(p) { toast((p==='monthly'?'Monthly ‚Çπ100':'Annual ‚Çπ1,000')+' ‚Äî Pay via UPI below.','success'); }

/* ‚îÄ‚îÄ OWNER ‚îÄ‚îÄ */
async function ownerLogin() {
  const uid=document.getElementById('ownerUid').value, pwd=document.getElementById('ownerPwd').value;
  try {
    const r=await fetch('/owner_stats',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:`uid=${encodeURIComponent(uid)}&pwd=${encodeURIComponent(pwd)}`});
    const d=await r.json();
    if(d.status==='ok') {
      document.getElementById('ownerLoginForm').style.display='none';
      document.getElementById('ownerDash').style.display='block';
      document.getElementById('statUsers').textContent=d.total_users;
      document.getElementById('statPremium').textContent=d.premium_users;
      toast('Welcome Owner! üëã','success');
    } else toast('Invalid credentials','error');
  } catch(e) { toast('Cannot connect to server','error'); }
}
function ownerLogout() {
  document.getElementById('ownerLoginForm').style.display='block';
  document.getElementById('ownerDash').style.display='none';
  document.getElementById('ownerUid').value='';
  document.getElementById('ownerPwd').value='';
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
function toast(msg,type='success') {
  const t=document.getElementById('toast');
  document.getElementById('toastIcon').textContent = type==='error'?'‚úï':'‚úì';
  document.getElementById('toastMsg').textContent = msg;
  t.className='toast '+type+' show';
  setTimeout(()=>t.classList.remove('show'),3000);
}
</script>
</body>
</html>